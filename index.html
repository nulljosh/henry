<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Henry - Portfolio Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: #f5f5f7;
            min-height: 100vh;
            padding: 20px;
            color: #1d1d1f;
        }

        :root {
            --accent: #007aff;
            --success: #34c759;
            --text-secondary: #86868b;
        }
        :root {
            --logo-ring: rgba(255, 255, 255, 0.7);
        }

        .back-button, .theme-toggle {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1d1d1f;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .back-button {
            text-decoration: none;
            font-size: 20px;
        }

        .theme-toggle {
            font-size: 18px;
            cursor: pointer;
            border: none;
        }

        .back-button:hover, .theme-toggle:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .back-button:active, .theme-toggle:active {
            transform: scale(0.98);
        }

        body.dark .back-button,
        body.dark .theme-toggle {
            background: rgba(44, 44, 46, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        body.dark .back-button:hover,
        body.dark .theme-toggle:hover {
            background: rgba(58, 58, 60, 1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        body.dark {
            background: #1d1d1f;
            color: #f5f5f7;
            --text-secondary: #98989d;
            --logo-ring: rgba(0, 0, 0, 0.6);
        }

        body.dark .glass-card {
            background: #2c2c2e;
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark h1, body.dark h2 {
            color: #f5f5f7;
        }

        body.dark p {
            color: #98989d;
        }

        body.dark table {
            background: #2c2c2e;
        }

        body.dark thead {
            background: #1d1d1f;
        }

        body.dark th {
            color: #98989d;
        }

        body.dark td {
            color: #f5f5f7;
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        body.dark tbody tr:hover {
            background: #3a3a3c;
        }

        body.dark tbody tr:last-child td {
            background: #1d1d1f;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 100px;
        }

        .glass-card {
            background: white;
            border-radius: 24px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
        }

        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            gap: 12px;
            z-index: 1000;
        }

        .brand-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 0 14px;
            height: 44px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform-origin: left center;
        }

        body.dark .brand-badge {
            background: rgba(44, 44, 46, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .brand-name {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.3px;
            line-height: 1;
        }

        .brand-tagline {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 500;
            line-height: 1;
            margin-top: 3px;
        }

        .portfolio-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 20px;
            margin-top: 8px;
        }


        .view-toggle {
            display: inline-flex;
            padding: 4px;
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .view-toggle button {
            font-size: 13px;
            font-weight: 600;
            padding: 6px 14px;
            border: none;
            border-radius: 999px;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1d1d1f;
        }

        .view-toggle button.active {
            background: #007aff;
            color: #f5f5f7;
            box-shadow: 0 4px 10px rgba(0, 122, 255, 0.25);
        }

        body.dark .view-toggle {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        body.dark .view-toggle button {
            color: #f5f5f7;
        }

        body.dark .view-toggle button.active {
            background: rgba(10, 132, 255, 0.85);
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
        }

        .portfolio-views {
            position: relative;
        }

        .portfolio-pie-view {
            display: flex;
            gap: 32px;
            align-items: center;
            flex-wrap: wrap;
        }

        .pie-chart-wrapper {
            position: relative;
            width: 260px;
            height: 260px;
            display: grid;
            place-items: center;
        }

        .pie-chart {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            position: relative;
            overflow: visible;
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            background: transparent;
        }

        .pie-chart canvas {
            width: 260px;
            height: 260px;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 50%;
            pointer-events: none;
        }

        .pie-chart.slice-active {
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.18), 0 0 0 8px rgba(0, 0, 0, 0.04);
            transform: translate(var(--slice-shift-x), var(--slice-shift-y)) scale(1.015);
        }

        .pie-center-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: 700;
            font-size: 20px;
            color: #1d1d1f;
            padding: 14px 18px;
            border-radius: 18px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            min-width: 140px;
            line-height: 1.3;
        }

        body.dark .pie-center-label {
            background: rgba(44, 44, 46, 0.92);
            color: #f5f5f7;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .pie-center-label span {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #6e6e73;
            text-transform: uppercase;
            letter-spacing: 0.4px;
        }

        body.dark .pie-center-label span {
            color: #d1d1d6;
        }

        .chart-legend {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            flex: 1;
        }

        @media (max-width: 768px) {
            .chart-legend {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .chart-legend li {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 12px;
            padding: 10px 14px;
        }

        body.dark .chart-legend li {
            background: rgba(255, 255, 255, 0.06);
        }

        .legend-swatch {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-label {
            font-weight: 600;
            color: #1d1d1f;
        }

        body.dark .legend-label {
            color: #f5f5f7;
        }

        .legend-value {
            margin-left: auto;
            color: var(--text-secondary);
            font-weight: 500;
        }

        body.dark .legend-value {
            color: #d1d1d6;
        }

        .chart-legend li.active {
            background: rgba(0, 122, 255, 0.12);
            color: #007aff;
        }

        body.dark .chart-legend li.active {
            background: rgba(10, 132, 255, 0.25);
            color: #0a84ff;
        }

        .pie-logo-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transition: transform 0.25s ease;
        }

        .pie-logo {
            position: absolute;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-size: 15px;
            font-weight: 700;
            color: #1d1d1f;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.18), 0 0 0 3px var(--logo-ring);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }

        .pie-logo span {
            pointer-events: none;
        }

        .pie-logo svg {
            width: 22px;
            height: 22px;
            display: block;
            pointer-events: none;
        }

        body.dark .pie-logo {
            color: #f5f5f7;
        }

        .pie-logo:hover,
        .pie-logo:focus-visible {
            transform: translate(-50%, -50%) scale(1.12);
            box-shadow: 0 10px 22px rgba(0, 0, 0, 0.25), 0 0 0 3px var(--logo-ring);
        }

        body.dark .pie-logo:hover,
        body.dark .pie-logo:focus-visible {
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.5), 0 0 0 3px var(--logo-ring);
        }

        .pie-logo.active {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35), 0 0 0 4px var(--logo-ring);
        }

        .portfolio-table-view {
            margin-top: 12px;
        }

        .card-collapsible-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            padding-top: 0;
            transition: max-height 0.35s ease, opacity 0.35s ease, padding-top 0.35s ease;
        }

        .collapsible-card.open .card-collapsible-content {
            opacity: 1;
            padding-top: 16px;
        }

        .hidden {
            display: none !important;
        }

        .earnings-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-left: 8px;
            box-shadow: 0 0 0 2px #ffffff;
        }

        .earnings-badge[data-status="beat"] {
            background: #34c759;
        }

        .earnings-badge[data-status="miss"] {
            background: #ff3b30;
        }

        .earnings-badge[data-status="upcoming"] {
            background: #0a84ff;
        }

        .earnings-badge[data-status="neutral"] {
            background: rgba(142, 142, 147, 0.5);
        }

        body.dark .earnings-badge {
            box-shadow: 0 0 0 2px #1d1d1f;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .market-copy {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .market-insights-card {
            background: #ffffff;
            color: #1d1d1f;
            border: 1px solid rgba(0, 0, 0, 0.06);
        }

        body.dark .market-insights-card {
            background: #2c2c2e;
            color: #f5f5f7;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .market-insights-toggle,
        .card-toggle {
            width: 100%;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 600;
            color: inherit;
            cursor: pointer;
            padding: 4px 0 8px;
        }

        .market-insights-toggle-icon,
        .card-toggle-icon {
            transition: transform 0.3s ease;
            font-size: 20px;
        }

        .market-insights-card.open .market-insights-toggle-icon {
            transform: rotate(180deg);
        }

        .collapsible-card.open .card-toggle-icon {
            transform: rotate(180deg);
        }

        .market-insights-content {
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            transition: max-height 0.3s ease, opacity 0.2s ease, padding-top 0.3s ease;
        }

        .market-insights-card.open .market-insights-content {
            opacity: 1;
            padding-top: 12px;
        }

        .market-insights-card .market-copy {
            color: #1d1d1f;
            transition: none;
        }

        .market-insights-card .market-copy strong {
            color: #1d1d1f;
            transition: none;
        }

        body.dark .market-insights-card .market-copy,
        body.dark .market-insights-card .market-copy strong {
            color: #f5f5f7;
        }

        .market-insights-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.4px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .market-clock-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: none;
        }

        .market-clock {
            padding: 4px 8px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.05);
        }

        body.dark .market-clock {
            background: rgba(255, 255, 255, 0.1);
        }

        .market-pulse {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 16px;
        }

        .market-pulse-item {
            background: rgba(0, 0, 0, 0.04);
            border-radius: 14px;
            padding: 18px 20px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-size: 18px;
            font-weight: 700;
        }

        .market-pulse-item span {
            display: block;
            margin-top: 8px;
            text-transform: none;
            letter-spacing: normal;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        body.dark .market-pulse-item {
            background: rgba(255, 255, 255, 0.06);
        }

        body.dark .market-pulse-item span {
            color: #d1d1d6;
        }

        .hidden-row {
            display: none;
        }

        .top-gain-badge {
            display: inline-block;
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            background: rgba(0, 122, 255, 0.12);
            color: var(--accent);
        }

        .top-gain-row td {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(0, 122, 255, 0.02));
        }

        .payday-highlight {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .payday-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .payday-amount {
            font-size: 24px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 4px;
        }

        .payday-note {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .payday-date {
            font-size: 13px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 6px;
        }

        body.dark .payday-date {
            color: #f5f5f7;
        }

        .progress-summary {
            margin-bottom: 24px;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-labels span:nth-child(2) {
            color: var(--accent);
        }

        .progress-bar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            height: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .progress-bar-fill {
            background: rgba(0, 122, 255, 0.85);
            height: 100%;
            width: 24%;
            border-radius: 12px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .heart {
            color: #ff3b30;
            animation: heartbeat 2s ease-in-out infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            10% { transform: scale(1.2); }
            20% { transform: scale(1); }
            30% { transform: scale(1.15); }
            40% { transform: scale(1); }
            100% { transform: scale(1); }
        }

        .site-footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #8e8e93;
            font-size: 14px;
        }

        .site-footer a {
            color: inherit;
            text-decoration: none;
            font-weight: 600;
        }

        .site-footer a:hover {
            text-decoration: underline;
        }

        h1 {
            color: #1d1d1f;
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        h2 {
            color: #6e6e73;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            letter-spacing: -0.2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
        }

        thead {
            background: #f5f5f7;
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #86868b;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: color 0.2s ease;
        }

        th:hover {
            color: #007aff;
        }

        th.sortable::after {
            content: ' â†•';
            opacity: 0.3;
            font-size: 10px;
        }

        th.sorted-asc::after {
            content: ' â†‘';
            opacity: 1;
            color: #007aff;
        }

        th.sorted-desc::after {
            content: ' â†“';
            opacity: 1;
            color: #007aff;
        }

        td {
            padding: 16px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 15px;
        }

        tbody tr:hover {
            background: #f5f5f7;
        }

        tbody tr.active {
            background: rgba(0, 122, 255, 0.08);
        }

        body.dark tbody tr.active {
            background: rgba(10, 132, 255, 0.18);
        }

        tbody tr:last-child td {
            font-weight: 600;
            background: #f5f5f7;
        }

        a {
            color: #007aff;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        a:hover {
            color: #0051d5;
        }

        .future-expense {
            opacity: 0.6;
            font-style: italic;
        }

        .earnings-badge {
            background: #007aff;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 600;
            margin-left: 4px;
            white-space: nowrap;
        }

        .earnings-badge.completed {
            background: #8e8e93;
        }

        .earnings-badge.upcoming-soon {
            background: #34c759;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .glass-card {
                padding: 20px;
                border-radius: 16px;
            }

            h1 {
                font-size: 32px;
            }

            h2 {
                font-size: 22px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px 6px;
            }

            .back-button, .theme-toggle {
                width: 40px;
                height: 40px;
            }

            .site-header {
                padding: 12px;
                gap: 8px;
            }

            .brand-badge {
                padding: 0 10px;
                height: 40px;
                gap: 6px;
            }

            .brand-name {
                font-size: 16px;
            }

            .brand-tagline {
                font-size: 11px;
            }

            .portfolio-pie-view {
                flex-direction: column;
                align-items: center;
            }

            .pie-chart {
                width: 220px;
                height: 220px;
            }

            .pie-center-label {
                min-width: 120px;
                font-size: 18px;
            }

            .chart-legend {
                width: 100%;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }

            .market-pulse {
                grid-template-columns: 1fr;
            }

            .market-clock-grid {
                flex-direction: column;
                align-items: flex-start;
            }
        }

    </style>
</head>
<body>
    <script>
        const holdingsConfig = [
            {
                symbol: 'PLTR',
                quoteSymbol: 'PLTR',
                logoLabel: 'PL',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"><circle cx="16" cy="12" r="6"/><path d="M11 18l5 8 5-8"/><path d="M8 12h6"/></svg>',
                shares: 0.39,
                targetPrice: 370,
                fallbackPrice: 178.50,
                fallbackDailyChange: -2.94,
                color: '#4b5d86',
                url: 'https://finance.yahoo.com/quote/PLTR',
                earningsStatus: 'beat',
                earningsLabel: 'Earnings beat Nov 3'
            },
            {
                symbol: 'NVDA',
                quoteSymbol: 'NVDA',
                logoLabel: 'NV',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 18c4-6 10-10 16-10 5 0 8 3 8 7 0 3-1.6 5.5-4.2 7.5"/><circle cx="18" cy="16" r="4"/><path d="M8 24c3-5 7-8 12-8"/></svg>',
                shares: 0.5058,
                targetPrice: 390,
                fallbackPrice: 189.65,
                fallbackDailyChange: -1.83,
                color: '#9dd866',
                url: 'https://finance.yahoo.com/quote/NVDA',
                earningsStatus: 'upcoming',
                earningsLabel: 'Earnings Nov 19'
            },
            {
                symbol: 'GOOGL',
                quoteSymbol: 'GOOGL',
                logoLabel: 'G',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"><path d="M26 15h-8v6h8"/><path d="M26 23c-2.3 3-5.6 5-9.5 5-6.6 0-11.5-5.3-11.5-12s4.9-12 11.5-12c3.3 0 6.2 1 8.5 3"/></svg>',
                shares: 0.0102,
                targetPrice: 550,
                fallbackPrice: 287.15,
                fallbackDailyChange: -1.43,
                color: '#5c8df6',
                url: 'https://finance.yahoo.com/quote/GOOGL',
                earningsStatus: 'beat',
                earningsLabel: 'Earnings beat Oct 29'
            },
            {
                symbol: 'TSLA',
                quoteSymbol: 'TSLA',
                logoLabel: 'T',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8c4-2 16-2 20 0"/><path d="M16 8v16"/><path d="M11 10l5 14 5-14"/></svg>',
                shares: 0.1579,
                targetPrice: 800,
                fallbackPrice: 432.28,
                fallbackDailyChange: -1.67,
                color: '#ff7676',
                url: 'https://finance.yahoo.com/quote/TSLA',
                earningsStatus: 'miss',
                earningsLabel: 'Earnings missed Oct 23'
            },
            {
                symbol: 'AAPL',
                quoteSymbol: 'AAPL',
                logoLabel: 'ï£¿',
                logoSvg: '<svg viewBox="0 0 32 32" fill="currentColor"><path d="M21.8 4.5c-1.4.1-3.2 1-4.2 2.2-1 1.2-1.2 2.2-1.2 2.6 3.7.2 5.9-2.4 6.4-3-.2-.6-.5-1.4-1-1.8zM16 10.2c-2.8 0-4.1 1.8-6 1.8-1.9 0-3.4-1.8-6-1.8C2 10.2 0 12.6 0 16.9c0 5.1 4.3 12.7 8 12.7 1.6 0 2.4-1 4-1s2.4 1 4 1c4.3 0 8.9-6.5 8.9-12.3 0-4.9-3.2-7.1-6.9-7.1z" transform="translate(4 3)"/></svg>',
                shares: 0.7038,
                targetPrice: 500,
                fallbackPrice: 274.30,
                fallbackDailyChange: -0.35,
                color: '#c7d2ec',
                url: 'https://finance.yahoo.com/quote/AAPL',
                earningsStatus: 'beat',
                earningsLabel: 'Earnings beat Oct 30'
            },
            {
                symbol: 'SPY',
                quoteSymbol: 'SPY',
                logoLabel: 'SP',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round"><line x1="8" y1="10" x2="24" y2="10"/><line x1="8" y1="16" x2="22" y2="16"/><line x1="8" y1="22" x2="20" y2="22"/></svg>',
                shares: 0.3378,
                targetPrice: 1100,
                fallbackPrice: 683.87,
                fallbackDailyChange: 0.14,
                color: '#4f75b7',
                url: 'https://finance.yahoo.com/quote/SPY',
                earningsStatus: 'neutral',
                earningsLabel: 'Index fund'
            },
            {
                symbol: 'APP',
                quoteSymbol: 'APP',
                logoLabel: 'AP',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="20" height="20" rx="5"/><circle cx="16" cy="16" r="4"/><path d="M16 12v8M12 16h8"/></svg>',
                shares: 0.0998,
                targetPrice: 800,
                fallbackPrice: 586.52,
                fallbackDailyChange: -1.41,
                color: '#8b7dff',
                url: 'https://finance.yahoo.com/quote/APP',
                earningsStatus: 'beat',
                earningsLabel: 'Strong growth'
            },
            {
                symbol: 'CASH',
                quoteSymbol: 'CASH',
                logoLabel: '$',
                logoSvg: '<svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4v21M10 9h8a4 4 0 0 1 0 8h-4a4 4 0 0 0 0 8h10"/></svg>',
                shares: 1,
                targetPrice: 108.39,
                fallbackPrice: 108.39,
                fallbackDailyChange: 0,
                color: '#d1d1d6',
                url: '#',
                earningsStatus: 'neutral',
                earningsLabel: 'USD cash reserve'
            }
        ];

        let holdingsData = [];

        const FINANCIAL_CONFIG = {
            cadSavings: 200.49,
            cadToUsdRate: 0.72,
            debtGoal: 5000,
            monthlyPaymentCapacity: 423
        };

        const formatCurrency = (value, currency = 'USD', fractionDigits = 0) => {
            const numericValue = Number.isFinite(value) ? value : 0;
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency,
                minimumFractionDigits: fractionDigits,
                maximumFractionDigits: fractionDigits
            }).format(Math.round(numericValue));
        };
        const formatPrice = (value, currency = 'USD') => {
            const numericValue = Number.isFinite(value) ? value : 0;
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency,
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(numericValue);
        };
        const formatShares = (value) => {
            const fixed = value.toFixed(4);
            return fixed.replace(/\.?0+$/, '');
        };
        const formatPercent = (value) => {
            const numericValue = Number.isFinite(value) ? value : 0;
            const sign = numericValue > 0 ? '+' : '';
            return `${sign}${numericValue.toFixed(1)}%`;
        };
        const getContrastColor = (hex) => {
            const clean = hex.replace('#', '');
            const expanded = clean.length === 3 ? clean.split('').map(ch => ch + ch).join('') : clean;
            const r = parseInt(expanded.substring(0, 2), 16);
            const g = parseInt(expanded.substring(2, 4), 16);
            const b = parseInt(expanded.substring(4, 6), 16);
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            return luminance > 0.6 ? '#1d1d1f' : '#f5f5f7';
        };

        function buildHoldings(quoteMap = {}) {
            return holdingsConfig.map(item => {
                const quote = quoteMap[item.quoteSymbol || item.symbol];
                const price = quote?.regularMarketPrice ?? item.fallbackPrice ?? 0;
                const dailyChangePercent = quote?.regularMarketChangePercent ?? item.fallbackDailyChange ?? 0;
                const currency = quote?.currency || 'USD';
                const currentValue = price * item.shares;
                const targetValue = item.targetPrice * item.shares;
                const gainPercent = price > 0 ? ((item.targetPrice - price) / price) * 100 : 0;
                return {
                    ...item,
                    url: item.url || `https://finance.yahoo.com/quote/${item.quoteSymbol || item.symbol}`,
                    price,
                    currency,
                    dailyChangePercent,
                    currentValue,
                    targetValue,
                    gainPercent
                };
            });
        }

        async function loadHoldings() {
            return buildHoldings();
        }

        const formatMonthYear = (date) => date.toLocaleString('en-US', { month: 'long', year: 'numeric' });

        function updateFinancialSections(currentTotal, targetTotal) {
            const cadUsdValue = FINANCIAL_CONFIG.cadSavings * FINANCIAL_CONFIG.cadToUsdRate;
            const totalAssetsUsd = currentTotal + cadUsdValue;
            const remainingToGoal = Math.max(FINANCIAL_CONFIG.debtGoal - totalAssetsUsd, 0);
            const savedPercent = FINANCIAL_CONFIG.debtGoal > 0 ? (totalAssetsUsd / FINANCIAL_CONFIG.debtGoal) * 100 : 0;
            const progressLabels = document.querySelectorAll('.progress-labels span');
            if (progressLabels[0]) progressLabels[0].textContent = formatCurrency(0);
            if (progressLabels[1]) {
                const savedLabel = `${formatCurrency(totalAssetsUsd)} saved (${Math.round(Math.min(savedPercent, 100))}%)`;
                progressLabels[1].textContent = savedLabel;
            }
            if (progressLabels[2]) progressLabels[2].textContent = formatCurrency(FINANCIAL_CONFIG.debtGoal);

            const progressFill = document.querySelector('.progress-bar-fill');
            if (progressFill) {
                const clampedPercent = Math.max(0, Math.min(savedPercent, 100));
                progressFill.style.width = `${clampedPercent.toFixed(1)}%`;
            }

            const totalAssetsCell = document.getElementById('totalAssetsCell');
            if (totalAssetsCell) {
                totalAssetsCell.textContent = `${formatCurrency(currentTotal)} USD + ${formatCurrency(FINANCIAL_CONFIG.cadSavings, 'CAD')} (~${formatCurrency(cadUsdValue)} USD) = ~${formatCurrency(totalAssetsUsd)} USD`;
            }

            const remainingCell = document.getElementById('remainingToGoalCell');
            if (remainingCell) {
                remainingCell.textContent = remainingToGoal > 0 ? formatCurrency(remainingToGoal) : 'Goal reached ðŸŽ‰';
            }

            const monthsToGoal = remainingToGoal > 0 ? remainingToGoal / FINANCIAL_CONFIG.monthlyPaymentCapacity : 0;
            const monthsCell = document.getElementById('monthsToDebtFreeCell');
            if (monthsCell) {
                monthsCell.textContent = monthsToGoal > 0 ? `${monthsToGoal.toFixed(1)} months` : 'Paid off';
            }

            const debtFreeDateCell = document.getElementById('debtFreeDateCell');
            let projectedPayoffLabel = 'now';
            if (monthsToGoal > 0) {
                const payoffDate = new Date();
                payoffDate.setMonth(payoffDate.getMonth() + Math.ceil(monthsToGoal));
                projectedPayoffLabel = formatMonthYear(payoffDate);
                if (debtFreeDateCell) {
                    debtFreeDateCell.textContent = projectedPayoffLabel;
                }
            } else if (debtFreeDateCell) {
                debtFreeDateCell.textContent = 'You did it ðŸŽ‰';
            }

            const summaryTotal = document.getElementById('summaryTotalPortfolio');
            if (summaryTotal) summaryTotal.textContent = formatCurrency(currentTotal);

            const summaryTarget = document.getElementById('summaryTargetPortfolio');
            if (summaryTarget) summaryTarget.textContent = formatCurrency(targetTotal);

            const summaryGain = document.getElementById('summaryPotentialGain');
            if (summaryGain) {
                const gainDelta = targetTotal - currentTotal;
                const gainPercent = currentTotal > 0 ? (gainDelta / currentTotal) * 100 : 0;
                const sign = gainDelta >= 0 ? '+' : '-';
                summaryGain.textContent = `${sign}${formatCurrency(Math.abs(gainDelta))} (${sign}${Math.abs(Math.round(gainPercent))}%)`;
            }

            const summaryNetWorth = document.getElementById('summaryNetWorth');
            if (summaryNetWorth) {
                const netWorth = totalAssetsUsd - FINANCIAL_CONFIG.debtGoal;
                summaryNetWorth.textContent = `${formatCurrency(totalAssetsUsd)} - ${formatCurrency(FINANCIAL_CONFIG.debtGoal)} = ${formatCurrency(netWorth)}`;
            }

            return {
                totalAssetsUsd,
                cadUsdValue,
                remainingToGoal,
                monthsToGoal,
                debtFreeLabel: projectedPayoffLabel
            };
        }

        function initSlideToggle({ toggle, content, card, defaultOpen = false }) {
            if (!toggle || !content) return;
            const hostCard = card || content.closest('.glass-card');

            const expand = () => {
                if (content._expandTimer) clearTimeout(content._expandTimer);
                content.style.overflow = 'visible';
                content.style.maxHeight = `${content.scrollHeight}px`;
                content._expandTimer = setTimeout(() => {
                    if (toggle.getAttribute('aria-expanded') === 'true') {
                        content.style.maxHeight = 'none';
                    }
                }, 400);
            };

            const collapse = () => {
                if (content._expandTimer) clearTimeout(content._expandTimer);
                content.style.overflow = 'hidden';
                if (content.style.maxHeight === 'none') {
                    content.style.maxHeight = `${content.scrollHeight}px`;
                    void content.offsetHeight;
                }
                content.style.maxHeight = '0px';
            };

            const setState = (expanded) => {
                toggle.setAttribute('aria-expanded', String(expanded));
                content.setAttribute('aria-hidden', String(!expanded));
                if (hostCard) {
                    hostCard.classList.toggle('open', expanded);
                }
                if (expanded) {
                    expand();
                } else {
                    collapse();
                }
            };

            setState(defaultOpen);

            toggle.addEventListener('click', () => {
                const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
                setState(!isExpanded);
            });

            window.addEventListener('resize', () => {
                if (toggle.getAttribute('aria-expanded') === 'true') {
                    if (content.style.maxHeight === 'none') {
                        content.style.maxHeight = `${content.scrollHeight}px`;
                        content._expandTimer = setTimeout(() => {
                            if (toggle.getAttribute('aria-expanded') === 'true') {
                                content.style.maxHeight = 'none';
                            }
                        }, 400);
                    } else {
                        content.style.maxHeight = `${content.scrollHeight}px`;
                    }
                }
            });
        }

        const MARKET_TZ = 'America/Los_Angeles';

        function getMarketSessionInfo(now = new Date()) {
            const openHour = 6; // 6:30 AM PST
            const openMinute = 30;
            const closeHour = 13; // 1:00 PM PST
            const closeMinute = 0;
            const open = new Date(now.toLocaleString('en-US', { timeZone: MARKET_TZ }));
            open.setHours(openHour, openMinute, 0, 0);
            const close = new Date(now.toLocaleString('en-US', { timeZone: MARKET_TZ }));
            close.setHours(closeHour, closeMinute, 0, 0);
            const beforeOpen = now < open;
            const afterClose = now > close;
            const status = beforeOpen ? 'PRE' : afterClose ? 'POST' : 'OPEN';
            const target = beforeOpen ? open : afterClose ? open.setDate(open.getDate() + 1) && open : close;
            const remainingMs = target - now;
            const remaining = remainingMs > 0 ? {
                hours: Math.floor(remainingMs / (1000 * 60 * 60)),
                minutes: Math.floor((remainingMs / (1000 * 60)) % 60),
                seconds: Math.floor((remainingMs / 1000) % 60),
                label: beforeOpen ? 'opens' : afterClose ? 'next open' : 'closes'
            } : null;
            return { status, remaining };
        }

        let marketCountdownTimer = null;
        let marketClockTimer = null;

        function updateMarketInsights(financialSnapshot = {}) {
            const list = document.getElementById('marketPulseList');
            if (!list) return;
            const timestampLabel = document.getElementById('marketInsightsTimestamp');
            const renderClocks = () => {
                const pstClock = document.getElementById('pstClock');
                const estClock = document.getElementById('estClock');
                if (!pstClock || !estClock) return;
                const now = new Date();
                const pst = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
                const est = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
                pstClock.textContent = `PST â€” ${pst.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
                estClock.textContent = `EST â€” ${est.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
            };

            const renderTimestamp = () => {
                if (!timestampLabel) return;
                const now = new Date();
                const pacificNow = new Date(now.toLocaleString('en-US', { timeZone: MARKET_TZ }));
                const dateLabel = pacificNow.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const timeLabel = pacificNow.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                const session = getMarketSessionInfo(pacificNow);
                const countdownText = session.remaining
                    ? ` Â· ${session.remaining.label} in ${session.remaining.hours}h ${session.remaining.minutes}m`
                    : '';
                const sessionLabel = session.status === 'OPEN' ? 'market live' : session.status === 'PRE' ? 'pre-market' : 'after hours';
                timestampLabel.textContent = `${dateLabel} Â· ${timeLabel} PST Â· ${sessionLabel}${countdownText}`;
            };
            if (timestampLabel) {
                renderTimestamp();
                if (marketCountdownTimer) clearTimeout(marketCountdownTimer);
                const scheduleTick = () => {
                    renderTimestamp();
                    marketCountdownTimer = setTimeout(scheduleTick, 60000);
                };
                marketCountdownTimer = setTimeout(scheduleTick, 60000);
                renderClocks();
                if (marketClockTimer) clearTimeout(marketClockTimer);
                const scheduleClock = () => {
                    renderClocks();
                    marketClockTimer = setTimeout(scheduleClock, 60000);
                };
                marketClockTimer = setTimeout(scheduleClock, 60000);
            }
            if (!holdingsData.length) return;
            const movers = [...holdingsData].sort((a, b) => b.dailyChangePercent - a.dailyChangePercent);
            const topMover = movers[0];
            const laggard = movers.length > 1 ? movers[movers.length - 1] : movers[0];
            const upside = holdingsData.reduce((best, item) => (item.gainPercent > best.gainPercent ? item : best), holdingsData[0]);
            const remaining = financialSnapshot.remainingToGoal ?? null;
            const debtEta = financialSnapshot.debtFreeLabel;
            const payoffLine = remaining !== null
                ? remaining > 0
                    ? `${formatCurrency(remaining)} to go Â· pacing ${debtEta} with ${formatCurrency(FINANCIAL_CONFIG.monthlyPaymentCapacity)}/mo`
                    : `Goal funded Â· redeploy ${formatCurrency(FINANCIAL_CONFIG.monthlyPaymentCapacity)}/mo`
                : `Keep ${formatCurrency(FINANCIAL_CONFIG.monthlyPaymentCapacity)}/mo on autopay`;
            const upsidePercent = Math.max(Math.round(upside.gainPercent), 0);
            const insights = [
                {
                    title: 'LEADER BOARD',
                    detail: `${topMover.symbol} closed ${formatPercent(topMover.dailyChangePercent)}${topMover.earningsLabel ? ` Â· ${topMover.earningsLabel}` : ''} â€” strong momentum.`
                },
                {
                    title: 'LAGGARD CHECK',
                    detail: `${laggard.symbol} down ${formatPercent(laggard.dailyChangePercent)} today â€” watch for reversal signal before adding.`
                },
                {
                    title: 'RUNWAY + CASH',
                    detail: `${upside.symbol} has ~${upsidePercent}% upside to ${formatPrice(upside.targetPrice)} target while ${payoffLine}.`
                }
            ];
            list.innerHTML = '';
            insights.forEach(item => {
                const block = document.createElement('div');
                block.className = 'market-pulse-item';
                block.textContent = item.title;
                const detail = document.createElement('span');
                detail.textContent = item.detail;
                block.appendChild(detail);
                list.appendChild(block);
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            document.getElementById('themeIcon').textContent = isDark ? 'ðŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Scroll-based header expansion
        document.addEventListener('DOMContentLoaded', () => {
            const siteHeader = document.querySelector('.site-header');
            const brandBadge = document.querySelector('.brand-badge');
            let ticking = false;

            function updateHeaderSpacing() {
                const scrollY = window.scrollY;
                const maxScroll = 400; // Max scroll distance for full effect
                const scrollProgress = Math.min(scrollY / maxScroll, 1);

                // Mobile-first: adjust based on screen size
                const isMobile = window.innerWidth <= 768;
                const startPadding = isMobile ? 12 : 20;
                const minPadding = isMobile ? 8 : 8;

                // DECREASE side padding to push to corners
                const sidePadding = startPadding - (scrollProgress * (startPadding - minPadding));

                // Shrink brand badge as we scroll (less aggressive on mobile)
                const scaleAmount = isMobile ? 0.2 : 0.3;
                const opacityAmount = isMobile ? 0.3 : 0.5;
                const badgeScale = 1 - (scrollProgress * scaleAmount);
                const badgeOpacity = 1 - (scrollProgress * opacityAmount);

                if (siteHeader) {
                    siteHeader.style.paddingLeft = `${sidePadding}px`;
                    siteHeader.style.paddingRight = `${sidePadding}px`;
                }

                if (brandBadge) {
                    brandBadge.style.transform = `scale(${badgeScale})`;
                    brandBadge.style.opacity = badgeOpacity;
                }

                ticking = false;
            }

            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(updateHeaderSpacing);
                    ticking = true;
                }
            });

            // Initialize on load
            updateHeaderSpacing();
        });

        const theme = localStorage.getItem('theme');
        if (theme === 'dark' || (!theme && matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
            document.getElementById('themeIcon').textContent = 'ðŸŒ™';
        }

        matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (!theme) {
                document.body.classList.toggle('dark', e.matches);
                document.getElementById('themeIcon').textContent = e.matches ? 'ðŸŒ™' : 'â˜€ï¸';
            }
        });

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                holdingsData = await loadHoldings();
            } catch (error) {
                console.error('Failed to load holdings:', error);
                holdingsData = buildHoldings();
            }
            if (!holdingsData || holdingsData.length === 0) {
                holdingsData = buildHoldings();
            }
            const table = document.getElementById('stockTable');
            const headers = table ? table.querySelectorAll('th') : [];
            const tbody = table ? table.querySelector('tbody') : null;
            const totalsRow = table ? table.querySelector('tfoot tr') : null;
            const pieHoldings = [...holdingsData].sort((a, b) => b.currentValue - a.currentValue);
            const tableHoldings = [...holdingsData].sort((a, b) => b.dailyChangePercent - a.dailyChangePercent);

            const currentTotal = holdingsData.reduce((sum, holding) => sum + holding.currentValue, 0);
            const targetTotal = holdingsData.reduce((sum, holding) => sum + holding.targetValue, 0);

            const financialSnapshot = updateFinancialSections(currentTotal, targetTotal);
            updateMarketInsights(financialSnapshot);
 
            if (totalsRow) {
                const currentCell = totalsRow.querySelector('td:nth-child(5)');
                const targetCell = totalsRow.querySelector('td:nth-child(7)');
                const gainCell = totalsRow.querySelector('td:nth-child(8)');
                if (currentCell) currentCell.innerHTML = `<strong>${formatCurrency(currentTotal)}</strong>`;
                if (targetCell) targetCell.innerHTML = `<strong>${formatCurrency(targetTotal)}</strong>`;
                if (gainCell) {
                    const totalGainPercent = currentTotal > 0 ? Math.round(((targetTotal - currentTotal) / currentTotal) * 100) : 0;
                    const gainSign = totalGainPercent >= 0 ? '+' : '';
                    gainCell.innerHTML = `<strong>${gainSign}${totalGainPercent}%</strong>`;
                }
            }

            const pieChart = document.getElementById('stockPieChart');
            const pieCanvas = document.getElementById('stockPieCanvas');
            let pieCtx = pieCanvas ? pieCanvas.getContext('2d') : null;
            let pieRenderFrame = null;
            const pieCenter = document.getElementById('stockPieCenter');
            const pieLegend = document.getElementById('stockPieLegend');
            const pieLogos = document.getElementById('stockPieLogos');
            const PIE_ACTIVE_SCALE = 1.015;
            const PIE_RADIUS = 120;
            const PIE_CENTER_COORD = 130;

            const resizePieCanvas = () => {
                if (!pieCanvas) return;
                const rect = pieChart.getBoundingClientRect();
                const size = Math.min(rect.width, rect.height);
                pieCanvas.width = size;
                pieCanvas.height = size;
                const scale = window.devicePixelRatio || 1;
                pieCanvas.style.width = `${size}px`;
                pieCanvas.style.height = `${size}px`;
                pieCanvas.width = size * scale;
                pieCanvas.height = size * scale;
                pieCtx = pieCanvas.getContext('2d');
                pieCtx.scale(scale, scale);
            };
            if (pieCanvas) {
                resizePieCanvas();
                window.addEventListener('resize', resizePieCanvas);
            }
            const legendMap = {};
            const logoMap = {};
            const tableRowMap = {};
            const sliceGeometry = {};
            let activeSymbol = null;

            const schedulePieRender = () => {
                if (pieRenderFrame) cancelAnimationFrame(pieRenderFrame);
                pieRenderFrame = requestAnimationFrame(() => {
                    resizePieCanvas();
                    renderPie(activeSymbol);
                });
            };

            const renderPie = (activeSymbol = null) => {
                if (!pieCtx || !pieCanvas) {
                    console.warn('Canvas context not available for pie chart');
                    return;
                }
                try {
                    pieCtx.clearRect(0, 0, pieCanvas.width, pieCanvas.height);
                } catch (e) {
                    console.error('Failed to clear canvas:', e);
                    return;
                }
                try {
                    pieHoldings.forEach(item => {
                        const geometry = sliceGeometry[item.symbol];
                        if (!geometry) return;
                        const startAngle = (geometry.startDeg - 90) * (Math.PI / 180);
                        const sweepAngle = geometry.sweepDeg * (Math.PI / 180);
                        const endAngle = startAngle + sweepAngle;
                        const isActive = activeSymbol === item.symbol;
                        const offset = isActive ? 6 : 0;
                        const midAngle = startAngle + sweepAngle / 2;
                        const dx = Math.cos(midAngle) * offset;
                        const dy = Math.sin(midAngle) * offset;
                        pieCtx.beginPath();
                        pieCtx.moveTo(PIE_CENTER_COORD + dx, PIE_CENTER_COORD + dy);
                        pieCtx.arc(PIE_CENTER_COORD + dx, PIE_CENTER_COORD + dy, PIE_RADIUS + (isActive ? 2 : 0), startAngle, endAngle);
                        pieCtx.closePath();
                        pieCtx.fillStyle = item.color;
                        pieCtx.shadowColor = 'rgba(0,0,0,0.08)';
                        pieCtx.shadowBlur = isActive ? 20 : 8;
                        pieCtx.fill();
                    });
                } catch (e) {
                    console.error('Failed to render pie slices:', e);
                }
            };

            const clearSliceHighlight = () => {
                renderPie();
                if (pieLogos) {
                    pieLogos.style.transform = 'translate(0px, 0px) scale(1)';
                }
            };

            const highlightSlice = (item) => {
                if (!pieChart) return;
                const geometry = sliceGeometry[item.symbol];
                if (!geometry) return;
                const { midAngle } = geometry;
                const radians = (midAngle - 90) * (Math.PI / 180);
                const shiftX = Math.cos(radians) * 10;
                const shiftY = Math.sin(radians) * 10;
                if (pieLogos) {
                    pieLogos.style.transform = `translate(${shiftX}px, ${shiftY}px) scale(${PIE_ACTIVE_SCALE})`;
                }
                renderPie(item.symbol);
            };

            const defaultCenter = () => {
                if (pieCenter) {
                    pieCenter.innerHTML = `${formatCurrency(currentTotal)}<span>Current</span>`;
                }
                clearSliceHighlight();
                Object.values(legendMap).forEach(li => li.classList.remove('active'));
                Object.values(logoMap).forEach(logo => logo.classList.remove('active'));
                Object.values(tableRowMap).forEach(row => row.classList.remove('active'));
            };

            const activateSlice = (symbol) => {
                const item = holdingsData.find(entry => entry.symbol === symbol);
                if (!item || !pieCenter) return;
                activeSymbol = symbol;
                pieCenter.innerHTML = `${formatCurrency(item.currentValue, item.currency)}<span>${item.symbol} â€¢ ${formatPercent(item.gainPercent)} target</span>`;
                Object.entries(legendMap).forEach(([sym, li]) => {
                    li.classList.toggle('active', sym === symbol);
                });
                Object.entries(logoMap).forEach(([sym, logo]) => {
                    logo.classList.toggle('active', sym === symbol);
                });
                Object.entries(tableRowMap).forEach(([sym, row]) => {
                    row.classList.toggle('active', sym === symbol);
                });
                highlightSlice(item);
            };

            const resetSlice = () => {
                activeSymbol = null;
                defaultCenter();
            };
            const toggleSlice = (symbol) => {
                if (activeSymbol === symbol) {
                    resetSlice();
                } else {
                    activateSlice(symbol);
                }
            };
            if (pieChart && pieCenter && pieLegend) {
                let startPercent = 0;
                pieHoldings.forEach(item => {
                    const share = currentTotal > 0 ? item.currentValue / currentTotal : 0;
                    const sweepPercent = share * 100;
                    const startDeg = startPercent * 3.6;
                    const sweepDeg = sweepPercent * 3.6;
                    sliceGeometry[item.symbol] = {
                        startDeg,
                        sweepDeg,
                        midAngle: startDeg + sweepDeg / 2,
                        color: item.color
                    };
                    startPercent += sweepPercent;
                });
                schedulePieRender();
                pieChart.style.cursor = 'pointer';

                pieChart.addEventListener('mousemove', (event) => {
                    if (!sliceGeometry || !Object.keys(sliceGeometry).length) return;
                    const rect = pieChart.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const deltaX = event.clientX - centerX;
                    const deltaY = event.clientY - centerY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    const radius = rect.width / 2;
                    if (distance > radius || distance < radius * 0.25) {
                        if (!activeSymbol) {
                            clearSliceHighlight();
                        }
                        return;
                    }
                    let angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                    angle = angle < -90 ? 450 + angle : angle + 90;
                    const matched = pieHoldings.find(item => {
                        const geom = sliceGeometry[item.symbol];
                        if (!geom) return false;
                        const normalized = angle % 360;
                        const start = geom.startDeg % 360;
                        const end = (geom.startDeg + geom.sweepDeg) % 360;
                        if (geom.sweepDeg >= 360) return true;
                        if (start < end) {
                            return normalized >= start && normalized <= end;
                        }
                        return normalized >= start || normalized <= end;
                    });
                    if (matched) {
                        activateSlice(matched.symbol);
                    }
                });

                pieChart.addEventListener('mouseleave', () => {
                    if (!activeSymbol) {
                        clearSliceHighlight();
                    } else {
                        activateSlice(activeSymbol);
                    }
                });
                pieChart.addEventListener('click', (event) => {
                    const rect = pieChart.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    const deltaX = event.clientX - centerX;
                    const deltaY = event.clientY - centerY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    const radius = rect.width / 2;
                    if (distance > radius || distance < radius * 0.25) return;
                    let angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);
                    angle = angle < -90 ? 450 + angle : angle + 90;
                    const matched = pieHoldings.find(item => {
                        const geom = sliceGeometry[item.symbol];
                        if (!geom) return false;
                        const normalized = angle % 360;
                        const start = geom.startDeg % 360;
                        const end = (geom.startDeg + geom.sweepDeg) % 360;
                        if (geom.sweepDeg >= 360) return true;
                        if (start < end) {
                            return normalized >= start && normalized <= end;
                        }
                        return normalized >= start || normalized <= end;
                    });
                    if (matched) {
                        toggleSlice(matched.symbol);
                    }
                });
                pieCenter.innerHTML = `${formatCurrency(currentTotal)}<span>Current</span>`;

                pieLegend.innerHTML = '';
                if (pieLogos) {
                    pieLogos.innerHTML = '';
                }
                pieHoldings.forEach(item => {
                    const li = document.createElement('li');
                    const swatch = document.createElement('span');
                    swatch.className = 'legend-swatch';
                    swatch.style.background = item.color;

                    const label = document.createElement('span');
                    label.className = 'legend-label';
                    label.textContent = item.symbol;

                    const value = document.createElement('span');
                    value.className = 'legend-value';
                    value.textContent = formatCurrency(item.currentValue, item.currency);

                    li.appendChild(swatch);
                    li.appendChild(label);
                    li.appendChild(value);
                    pieLegend.appendChild(li);
                    legendMap[item.symbol] = li;
                    li.tabIndex = 0;
                    li.setAttribute('role', 'button');
                    li.setAttribute('aria-label', `${item.symbol} ${formatCurrency(item.currentValue, item.currency)}, ${formatPercent(item.gainPercent)} potential`);
                    const enterLegend = () => activateSlice(item.symbol);
                    const leaveLegend = () => resetSlice();
                    li.addEventListener('mouseenter', enterLegend);
                    li.addEventListener('mouseleave', leaveLegend);
                    li.addEventListener('focus', enterLegend);
                    li.addEventListener('blur', leaveLegend);
                    li.addEventListener('click', () => toggleSlice(item.symbol));
                });

                if (pieLogos) {
                    pieHoldings.forEach(item => {
                        const geometry = sliceGeometry[item.symbol];
                        const midAngle = geometry ? geometry.midAngle : 0;
                        const radians = (midAngle - 90) * (Math.PI / 180);
                        const radius = 125; // stay within wrapper bounds
                        const x = 130 + Math.cos(radians) * radius;
                        const y = 130 + Math.sin(radians) * radius;
                        const logo = document.createElement('div');
                        logo.className = 'pie-logo';
                        logo.style.background = item.color;
                        logo.style.color = getContrastColor(item.color);
                        logo.style.left = `${x}px`;
                        logo.style.top = `${y}px`;
                        logo.dataset.symbol = item.symbol;
                        logo.tabIndex = 0;
                        logo.setAttribute('role', 'button');
                        logo.setAttribute('aria-label', `${item.symbol} ${formatCurrency(item.currentValue, item.currency)}, ${formatPercent(item.gainPercent)} potential`);
                        if (item.logoSvg) {
                            logo.innerHTML = item.logoSvg;
                        } else {
                            const span = document.createElement('span');
                            span.textContent = item.logoLabel || item.symbol[0];
                            logo.appendChild(span);
                        }
                        pieLogos.appendChild(logo);
                        logoMap[item.symbol] = logo;
                        const enterLogo = () => activateSlice(item.symbol);
                        const leaveLogo = () => resetSlice();
                        logo.addEventListener('mouseenter', enterLogo);
                        logo.addEventListener('mouseleave', leaveLogo);
                        logo.addEventListener('focus', enterLogo);
                        logo.addEventListener('blur', leaveLogo);
                        logo.addEventListener('click', (e) => {
                            e.preventDefault();
                            toggleSlice(item.symbol);
                        });
                    });
                }
                defaultCenter();
            }

            if (tbody) {
                tbody.innerHTML = '';
                tableHoldings.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.dataset.symbol = item.symbol;
                    tr.tabIndex = 0;

                    const symbolCell = document.createElement('td');
                    const link = document.createElement('a');
                    link.href = item.url || '#';
                    link.target = '_blank';
                    link.rel = 'noopener';
                    link.textContent = item.symbol;
                    symbolCell.appendChild(link);

                    if (item.earningsStatus) {
                        const badge = document.createElement('span');
                        badge.className = 'earnings-badge';
                        badge.dataset.status = item.earningsStatus;
                        badge.setAttribute('role', 'img');
                        badge.setAttribute('aria-label', item.earningsLabel || item.earningsStatus);
                        badge.title = item.earningsLabel || item.earningsStatus;
                        symbolCell.appendChild(badge);
                    }

                    const sharesCell = document.createElement('td');
                    sharesCell.textContent = formatShares(item.shares);

                    const priceCell = document.createElement('td');
                    priceCell.textContent = formatPrice(item.price, item.currency);

                    const dailyCell = document.createElement('td');
                    const dailyValue = Number.isFinite(item.dailyChangePercent) ? item.dailyChangePercent : 0;
                    const dailySign = dailyValue > 0 ? '+' : '';
                    dailyCell.textContent = `${dailySign}${dailyValue.toFixed(2)}%`;
                    dailyCell.style.color = dailyValue > 0 ? '#2ecc71' : dailyValue < 0 ? '#ff3b30' : 'inherit';
                    dailyCell.style.fontWeight = '600';

                    const currentCell = document.createElement('td');
                    currentCell.textContent = formatCurrency(item.currentValue, item.currency);

                    const targetPriceCell = document.createElement('td');
                    targetPriceCell.textContent = formatPrice(item.targetPrice);

                    const targetValueCell = document.createElement('td');
                    targetValueCell.textContent = formatCurrency(item.targetValue);

                    const gainCell = document.createElement('td');
                    gainCell.textContent = formatPercent(item.gainPercent);

                    tr.appendChild(symbolCell);
                    tr.appendChild(sharesCell);
                    tr.appendChild(priceCell);
                    tr.appendChild(dailyCell);
                    tr.appendChild(currentCell);
                    tr.appendChild(targetPriceCell);
                    tr.appendChild(targetValueCell);
                    tr.appendChild(gainCell);

                    tr.addEventListener('mouseenter', () => activateSlice(item.symbol));
                    tr.addEventListener('mouseleave', () => resetSlice());
                    tr.addEventListener('focusin', () => activateSlice(item.symbol));
                    tr.addEventListener('focusout', () => resetSlice());
                    tr.addEventListener('click', () => toggleSlice(item.symbol));
                    tr.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter' || event.key === ' ') {
                            event.preventDefault();
                            toggleSlice(item.symbol);
                        }
                    });

                    tbody.appendChild(tr);
                    tableRowMap[item.symbol] = tr;
                });

                defaultCenter();
            }

            const pieView = document.getElementById('stockPieView');
            const tableView = document.getElementById('stockTableWrapper');
            const viewToggleButtons = document.querySelectorAll('[data-view-toggle]');

            function setPortfolioView(view) {
                if (!pieView || !tableView) return;
                if (view === 'table') {
                    pieView.classList.add('hidden');
                    tableView.classList.remove('hidden');
                } else {
                    pieView.classList.remove('hidden');
                    tableView.classList.add('hidden');
                    schedulePieRender();
                }

                viewToggleButtons.forEach(btn => {
                    const isActive = btn.dataset.viewToggle === view;
                    btn.classList.toggle('active', isActive);
                    btn.setAttribute('aria-pressed', String(isActive));
                });

                resetSlice();
            }

            setPortfolioView('pie');
            defaultCenter();

            viewToggleButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const view = button.dataset.viewToggle;
                    setPortfolioView(view);
                });
            });

            if (pieCenter) {
                pieCenter.tabIndex = 0;
                pieCenter.addEventListener('click', () => resetSlice());
                pieCenter.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        resetSlice();
                    }
                });
            }

            initSlideToggle({
                toggle: document.getElementById('marketInsightsToggle'),
                content: document.getElementById('marketInsightsContent'),
                card: document.getElementById('marketInsightsCard'),
                defaultOpen: false
            });
            initSlideToggle({
                toggle: document.getElementById('budgetToggle'),
                content: document.getElementById('budgetContent'),
                card: document.getElementById('budgetCard'),
                defaultOpen: false
            });
            initSlideToggle({
                toggle: document.getElementById('debtToggle'),
                content: document.getElementById('debtContent'),
                card: document.getElementById('debtCard'),
                defaultOpen: false
            });
            initSlideToggle({
                toggle: document.getElementById('summaryToggle'),
                content: document.getElementById('summaryContent'),
                card: document.getElementById('summaryCard'),
                defaultOpen: false
            });

            headers.forEach((header, index) => {
                header.classList.add('sortable');
                header.dataset.column = index;
                header.dataset.order = 'desc';
            });

            function getCellValue(row, index) {
                const cell = row ? row.cells[index] : null;
                if (!cell) return '';
                const text = cell.textContent.trim();
                if (text.startsWith('$')) return parseFloat(text.replace(/[$,]/g, '')) || 0;
                if (text.includes('%')) return parseFloat(text.replace(/[+%]/g, '')) || 0;
                if (!isNaN(text) && text !== '') return parseFloat(text);
                return text.toLowerCase();
            }

            function sortTable(column, order) {
                if (!tbody) return;
                const rows = Array.from(tbody.querySelectorAll('tr'));
                rows.sort((a, b) => {
                    const aVal = getCellValue(a, column);
                    const bVal = getCellValue(b, column);
                    if (typeof aVal === 'number' && typeof bVal === 'number') {
                        return order === 'asc' ? aVal - bVal : bVal - aVal;
                    }
                    return order === 'asc' ? (aVal > bVal ? 1 : aVal < bVal ? -1 : 0) : (aVal < bVal ? 1 : aVal > bVal ? -1 : 0);
                });

                tbody.innerHTML = '';
                rows.forEach(row => tbody.appendChild(row));
            }

            headers.forEach(header => {
                header.addEventListener('click', () => {
                    const column = parseInt(header.dataset.column, 10);
                    const newOrder = header.dataset.order === 'asc' ? 'desc' : 'asc';

                    headers.forEach(h => {
                        h.classList.remove('sorted-asc', 'sorted-desc');
                        h.dataset.order = 'desc';
                    });

                    header.classList.add(newOrder === 'asc' ? 'sorted-asc' : 'sorted-desc');
                    header.dataset.order = newOrder;
                    sortTable(column, newOrder);
                });
            });

            const gainHeader = headers[7];
            if (gainHeader) {
                gainHeader.classList.add('sorted-desc');
                gainHeader.dataset.order = 'desc';
                sortTable(6, 'desc');
            }

            // Payday countdown
            function updatePaydayCountdown() {
                const now = new Date();
                const paydays = [
                    new Date('2025-11-19T00:00:00'),
                    new Date('2025-12-17T00:00:00'),
                    new Date('2026-01-19T00:00:00')
                ];
                let nextPayday = null;
                for (const payday of paydays) {
                    if (payday > now) {
                        nextPayday = payday;
                        break;
                    }
                }
                if (!nextPayday) {
                    const el = document.getElementById('paydayCountdown');
                    const dateLabel = document.getElementById('paydayDateLabel');
                    if (el) el.textContent = 'No upcoming payday';
                    if (dateLabel) dateLabel.textContent = '';
                    return;
                }
                const diff = Math.max(nextPayday - now, 0);
                const dayMs = 24 * 60 * 60 * 1000;
                const hourMs = 60 * 60 * 1000;
                const minuteMs = 60 * 1000;
                const secondMs = 1000;
                const days = Math.floor(diff / dayMs);
                const hours = Math.floor((diff % dayMs) / hourMs);
                const minutes = Math.floor((diff % hourMs) / minuteMs);
                const seconds = Math.floor((diff % minuteMs) / secondMs);
                const milliseconds = diff % 1000;
                const el = document.getElementById('paydayCountdown');
                if (el) {
                    el.textContent = `${days}d ${hours.toString().padStart(2, '0')}h ${minutes
                        .toString()
                        .padStart(2, '0')}m ${seconds.toString().padStart(2, '0')}s ${milliseconds
                        .toString()
                        .padStart(3, '0')}ms`;
                }
                const dateLabel = document.getElementById('paydayDateLabel');
                if (dateLabel) {
                    const formattedDate = nextPayday.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const weekday = nextPayday.toLocaleDateString('en-US', { weekday: 'short' });
                    dateLabel.textContent = `${formattedDate} Â· ${weekday}`;
                }
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', updatePaydayCountdown);
            } else {
                updatePaydayCountdown();
            }
            setInterval(updatePaydayCountdown, 100);
        });

    </script>

    <div class="container">
        <div class="site-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <a href="https://heyitsmejosh.com" class="back-button">â†</a>
                <div class="brand-badge">
                    <div>
                        <div class="brand-name">Henry</div>
                        <div class="brand-tagline">Portfolio Companion</div>
                    </div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
                <span id="themeIcon">â˜€ï¸</span>
            </button>
        </div>

        <div class="glass-card" id="portfolioCard">
            <div class="portfolio-header">
                <h2>Portfolio</h2>
                <div class="view-toggle" role="group" aria-label="Toggle portfolio view">
                    <button type="button" class="active" data-view-toggle="pie">Pie</button>
                    <button type="button" data-view-toggle="table">Table</button>
                </div>
            </div>
            <div class="portfolio-views" data-current-view="pie">
                <div class="portfolio-pie-view" id="stockPieView">
                    <div class="pie-chart-wrapper">
                        <div class="pie-chart" id="stockPieChart">
                            <canvas id="stockPieCanvas" width="260" height="260"></canvas>
                            <div class="pie-center-label" id="stockPieCenter"></div>
                        </div>
                        <div class="pie-logo-ring" id="stockPieLogos"></div>
                    </div>
                    <ul class="chart-legend" id="stockPieLegend"></ul>
                </div>
                <div class="portfolio-table-view hidden" id="stockTableWrapper">
                    <table id="stockTable">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Shares</th>
                                <th>Current Price</th>
                                <th>Daily %</th>
                                <th>Current Value</th>
                                <th>Target Price</th>
                                <th>Target Value</th>
                                <th>Gain</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/PLTR" target="_blank">PLTR</a></td>
                                <td>0.0171</td>
                                <td>$175.70</td>
                                <td>$3</td>
                                <td>$450</td>
                                <td>$8</td>
                                <td>+156%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/HOOD" target="_blank">HOOD</a></td>
                                <td>0.0934</td>
                                <td>$124.94</td>
                                <td>$12</td>
                                <td>$300</td>
                                <td>$28</td>
                                <td>+136%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/IWM" target="_blank">IWM</a></td>
                                <td>0.0208</td>
                                <td>$238.74</td>
                                <td>$5</td>
                                <td>$320</td>
                                <td>$7</td>
                                <td>+34%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/NVDA" target="_blank">NVDA</a></td>
                                <td>0.2702</td>
                                <td>$184.42</td>
                                <td>$50</td>
                                <td>$500</td>
                                <td>$135</td>
                                <td>+176%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/GOOGL" target="_blank">GOOGL</a></td>
                                <td>0.1485</td>
                                <td>$280.71</td>
                                <td>$42</td>
                                <td>$550</td>
                                <td>$82</td>
                                <td>+95%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/TSLA" target="_blank">TSLA</a></td>
                                <td>0.1422</td>
                                <td>$433.44</td>
                                <td>$62</td>
                                <td>$800</td>
                                <td>$114</td>
                                <td>+83%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/AAPL" target="_blank">AAPL</a></td>
                                <td>0.6538</td>
                                <td>$268.51</td>
                                <td>$176</td>
                                <td>$500</td>
                                <td>$327</td>
                                <td>+186%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/SPY" target="_blank">SPY</a></td>
                                <td>0.3378</td>
                                <td>$666.57</td>
                                <td>$227</td>
                                <td>$1,100</td>
                                <td>$372</td>
                                <td>+64%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/SBUX" target="_blank">SBUX</a></td>
                                <td>0.1432</td>
                                <td>$82.24</td>
                                <td>$12</td>
                                <td>$130</td>
                                <td>$19</td>
                                <td>+58%</td>
                            </tr>
                            <tr>
                                <td><a href="https://finance.yahoo.com/quote/V" target="_blank">V</a></td>
                                <td>0.2570</td>
                                <td>$336.64</td>
                                <td>$86</td>
                                <td>$550</td>
                                <td>$141</td>
                                <td>+64%</td>
                            </tr>
                            <tr>
                                <td><a href="https://www.coinbase.com/price/bitcoin" target="_blank">BTC-USD</a></td>
                                <td>0.0001927</td>
                                <td>$101,631</td>
                                <td>$20</td>
                                <td>$250,000</td>
                                <td>$48</td>
                                <td>+140%</td>
                            </tr>
                            <tr>
                                <td>CASH</td>
                                <td>â€”</td>
                                <td>â€”</td>
                                <td>$106</td>
                                <td>$106</td>
                                <td>$106</td>
                                <td>0%</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td><strong>Total</strong></td>
                                <td></td>
                                <td></td>
                                <td>â€”</td>
                                <td><strong>$787</strong></td>
                                <td></td>
                                <td><strong>$1,371</strong></td>
                                <td><strong>+74%</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <div class="glass-card market-insights-card" id="marketInsightsCard">
            <button class="market-insights-toggle" id="marketInsightsToggle" type="button" aria-expanded="false" aria-controls="marketInsightsContent">
                <span>Insights</span>
                <span class="market-insights-toggle-icon" aria-hidden="true">âŒ„</span>
            </button>
            <div class="market-insights-content" id="marketInsightsContent" aria-hidden="true">
                <div class="market-insights-meta">
                    <div id="marketInsightsTimestamp">Pre-market outlook loadingâ€¦</div>
                    <div class="market-clock-grid" id="marketClockGrid">
                        <div class="market-clock" id="pstClock">PST â€” --:--</div>
                        <div class="market-clock" id="estClock">EST â€” --:--</div>
                    </div>
                </div>
                <div class="market-pulse" id="marketPulseList">
                    <div class="market-pulse-item">
                        LOADING
                        <span>Fetching live quotes for a fresh read...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-card collapsible-card" id="budgetCard" data-collapsible>
            <button class="card-toggle" type="button" id="budgetToggle" aria-expanded="false" aria-controls="budgetContent">
                <span>Budget</span>
                <span class="card-toggle-icon" aria-hidden="true">âŒ„</span>
            </button>
            <div class="card-collapsible-content" id="budgetContent" aria-hidden="true">
                <div class="payday-highlight">
                    <div class="payday-title">Next Payday</div>
                    <div id="paydayCountdown" class="payday-amount">Loading...</div>
                    <div id="paydayDateLabel" class="payday-date"></div>
                    <div class="payday-note">$1,060 monthly / ~$500 to invest</div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Wallet / Savings (CAD)</td>
                            <td>$200.49</td>
                        </tr>
                        <tr>
                            <td>Trading Cash (USD)</td>
                            <td>$106</td>
                        </tr>
                        <tr>
                            <td>Income</td>
                            <td>$1,060</td>
                        </tr>
                        <tr>
                            <td>Food</td>
                            <td>-$300</td>
                        </tr>
                        <tr>
                            <td>Phone</td>
                            <td>-$130</td>
                        </tr>
                        <tr>
                            <td>Old phone (1 payment left)</td>
                            <td>-$177</td>
                        </tr>
                        <tr>
                            <td>Gym</td>
                            <td>-$30</td>
                        </tr>
                        <!-- <tr class="future-expense">
                            <td>Apple Watch (starts Nov)</td>
                            <td>-$33</td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="glass-card collapsible-card" id="debtCard" data-collapsible>
            <button class="card-toggle" type="button" id="debtToggle" aria-expanded="false" aria-controls="debtContent">
                <span>Debt</span>
                <span class="card-toggle-icon" aria-hidden="true">âŒ„</span>
            </button>
            <div class="card-collapsible-content" id="debtContent" aria-hidden="true">
                <div class="progress-summary">
                    <div class="progress-labels">
                        <span>$0</span>
                        <span>$931 saved (19%)</span>
                        <span>$5,000</span>
                    </div>
                    <div class="progress-bar-track">
                        <div class="progress-bar-fill"></div>
                    </div>
                </div>
                <table>
                    <tbody>
                        <tr>
                            <td>Total Assets (Portfolio + Savings)</td>
                            <td id="totalAssetsCell">$787 USD + $200 CAD (~$144 USD) = ~$931 USD</td>
                        </tr>
                        <tr>
                            <td>Debt Payoff Goal</td>
                            <td>$5,000</td>
                        </tr>
                        <tr>
                            <td>Remaining to Goal</td>
                            <td id="remainingToGoalCell">$4,069</td>
                        </tr>
                        <tr class="hidden-row">
                            <td>Current Debt</td>
                            <td>$4,000</td>
                        </tr>
                        <tr>
                            <td>Monthly Payment Capacity</td>
                            <td>$423</td>
                        </tr>
                        <tr>
                            <td>iPhone Sale (when sold)</td>
                            <td>+$200</td>
                        </tr>
                        <tr>
                            <td>Months Until Debt-Free</td>
                            <td id="monthsToDebtFreeCell">8.4 months</td>
                        </tr>
                        <tr>
                            <td>Debt-Free Date</td>
                            <td id="debtFreeDateCell">July 2026</td>
                        </tr>
                        <tr>
                            <td>MacBook Pro (16" M4 Pro, 24GB RAM, 512GB SSD)</td>
                            <td>Target: August 2025 (~$2,599)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="glass-card collapsible-card" id="summaryCard" data-collapsible>
            <button class="card-toggle" type="button" id="summaryToggle" aria-expanded="false" aria-controls="summaryContent">
                <span>Summary</span>
                <span class="card-toggle-icon" aria-hidden="true">âŒ„</span>
            </button>
            <div class="card-collapsible-content" id="summaryContent" aria-hidden="true">
                <table>
                    <tbody>
                        <tr>
                            <td><strong>Total Portfolio Value</strong></td>
                            <td id="summaryTotalPortfolio">$787</td>
                        </tr>
                        <tr>
                            <td><strong>2030 Target</strong></td>
                            <td id="summaryTargetPortfolio">$1,371</td>
                        </tr>
                        <tr>
                            <td><strong>Potential Gain</strong></td>
                            <td id="summaryPotentialGain">+$584 (+74%)</td>
                        </tr>
                        <tr>
                            <td><strong>Net Worth</strong></td>
                            <td id="summaryNetWorth">$931 - $5,000 = -$4,069</td>
                        </tr>
                        <tr>
                            <td><strong>Monthly Surplus (Nov)</strong></td>
                            <td>$1,060 - $637 = $423</td>
                        </tr>
                        <tr class="future-expense">
                            <td><strong>Monthly Surplus (Dec+)</strong></td>
                            <td>$1,060 - $460 = $600</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <a href="https://github.com/nulljosh/henry" target="_blank" rel="noopener">Built with <span class="heart">&hearts;</span> in Vancouver, BC</a><br>
        &copy; 2025-2026
    </footer>
</body>
</html>
